---
creation date: 2023-08-24 15:32
modification date: Thursday 24th August 2023 15:32:03
tag: splunk
---
# Configure alert actions

## Set up alert actions

Alert actions help you respond to triggered alerts.
## Email notification action

Send an email notification to specified recipients when an alert triggers. Email notifications can include information from search results, the search job, and alert triggering. 
## Use tokens in email notifications

Tokens represent data that a search generates. They work as placeholders or variables for data values that populate when the search completes.

#### Tokens available for email notification

There are four categories of tokens that access data generated by searches. Token availability varies by context.

| Category              | Context: Alert Actions | Context: Scheduled Reports | Context: Scheduled PDF delivery |
| --------------------- | ---------------------- | -------------------------- | ------------------------------- |
| Search metadata       | Yes                    | Yes                        | Yes                             |
| Search results        | Yes                    | Yes                        | No                              |
| Job information       | Yes                    | Yes                        | No                              |
| Server information    | Yes                    | Yes                        | Yes                             |
| Dashboard information | No                     | No                         | Yes                             | 

***Search metadata tokens*

Common tokens that access information about a search.

| Token                     | Description                                                                             |
| ------------------------- | --------------------------------------------------------------------------------------- |
| `$action.email.hostname$` | Email server hostname                                                                   |
| `$action.email.priority$` | Search priority                                                                         |
| `$alert.expires$`         | Alert expiration time                                                                   |
| `$alert.severity$`        | Alert severity level                                                                    |
| `$app$`                   | App context for the search                                                              |
| `$cron_schedule$`         | Search cron schedule                                                                    |
| `$description$`           | Human-readable search description                                                       |
| `$name$`                  | Search name                                                                             |
| `$next_scheduled_time$`   | The next time the search runs                                                           |
| `$owner$`                 | Search Owner                                                                            |
| `$results_link$`          | (Alert actions and scheduled reports only) Link to search results                       |
| `$search$`                | Search string                                                                           |
| `$trigger_date$`          | (Alert actions only) Date when alert triggered, formatted as `Month (string) Dat, Year` |
| `$trigger_time$`          | (Alert actions only) Time when alert triggered, formatted as epoch time                 |
| `$type$`                  | Indicates if the search is from an alert, report view, or the search command            |
| `$view_link$`             | Link to saved search                                                                    | 

***Results tokens***

You can access field values from the first result row that a search returns. Field availability for tokens depends on what fields are available in search results.

| Token                    | Description                                                                                                                           |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------- |
| `$result.`*`fieldname`*`$` | First value for the specified field name from the first search result row. Verify that the search generates the field being accessed. | 

To include or exclude specific fields from the results, use `fields` command in the base search for the alert. 

***Job information tokens*

Common token that access data specific to a search job, such as the search ID or messages generated by the search job.

| Token                | Description                                                        |
| -------------------- | ------------------------------------------------------------------ |
| `$job.earliestTime$` | Initial job start time                                             |
| `$job.eventSearch$`  | Subset of the search that appears before any transforming commands |
| `$job.latestTime$`   | Latest time recorded for the search job                            |
| `$job.messages$`     | List of error and debug messages generated by the search job       |
| `$job.resultCount$`  | Search job result count                                            |
| `$job.runDuration$`  | Time, in seconds, for search job completion                        |
| `$job.sid$`          | Search ID                                                          |
| `$job.label$`        | Search job name                                                    | 

***Server Tokens*

Provide details about your Splunk deployment.

| Token                 | Description                               |
| --------------------- | ----------------------------------------- |
| `$server.build$`      | Build number of the Splunk deployment     |
| `$server.serverName$` | Server name hosting the Splunk deployment |
| `$server.version$`    | Version number of the Splunk deployment   | 

***Dashboard metadata tokens*

Access dashboard metadata and include it in dashboard delivery emails.

| Token                     | Description                       |
| ------------------------- | --------------------------------- |
| `$dashboard.label$`       | Dashboard label                   |
| `$dashboard.title$`       | Equivalent to `$dashboard.label$` |
| `$dashboard.description$` | Dashboard description             |
| `$dashboard.id$`          | Dashboard ID                      | 

## Use a webhook alert action

Webhooks allow you to define custom callbacks on a particular web resource. When an alert triggers, the webhook makes an HTTP POST request on the URL. The webhook passes JSON formatted information about the alert in the body of the POST request.

#### Webhook data payload

The webhook POST request's JSON data payload includes the following details.
+ Search ID or SID for the saved search that triggered the alert.
+ Link to search results.
+ Search owner and app.
+ First result row from the triggering search results.

#### Configure a webhook alert action

Set up a webhook when selecting alert actions for an alert.
1. Follow one of these options to configure the webhook action when you create a new alert or edit an existing alert:

| Option                 | Steps                                                                                                                                             |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| Create a new alert     | From the **Search** page in the **Search and Reporting** app, select **Save as > Alert.** Enter alert details and configure throttling as needed. |
| Edit an existing alert | From the **Alerts** page in the **Search and Reporting** app, select **Edit > Edit actions** for an existing alert.                               | 

2. In the **Add Actions** menu, select **Webhook**.
3. Type a URL for the webhook. The target URL must be on the webhook allow list.
4. Click **Save**.
## Output results to a CSV lookup

This action writes the results of a triggered alert or a run of a scheduled report to a CSV **lookup** file that you specify. The results can replace the existing file contents, or they can be appended to the existing file contents.

The splunk software uses the `outputlookup` command to write the search results to the CSV lookup file.
#### Prerequisites

+ Learn how to upload CSV lookup files and create CSV lookup definitions.
#### Steps

1. You can configure the output of results to lookup action when you create a new alert, edit the actions for an existing alert, or define or edit the schedule for a report. 

| Option                                  | Steps                                                                                                                                             |
| --------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| Create a new alert                      | From the **Search** page in the **Search and Reporting** app, select **Save as > Alert.** Enter alert details and configure throttling as needed. |
| Edit an existing alert                  | From the **Alerts** page in the **Search and Reporting** app, select **Edit > Edit actions** for an existing alert.                               |
| Define or edit the schedule of a report | From the **Reports** page in the **Search and Reporting** app, select **Edit > Edit schedule** for a report.                                      | 

2. Click **Add Actions** and select **Output results to lookup**.
3. Provide a **File Name** of a CSV lookup file. You can provide the name of a CSV lookup file that has already been uploaded to your Splunk implementation, or you can provide a CSV lookup file name that is not currently uploaded.
	If you provide a CSV lookup file name that has not been uploaded to your Splunk implementation, the Splunk platform creates a CSV file with the file name you provide. The Splunk platform then populates the new CSV file with the results of that first triggering search job.
	To see a list of the CSV lookup files currently upload to your Splunk implementation, select **Settings > Lookups > Lookups table files**.
4. Determine how you would like to have the **Results** written to the CSV lookup file.

| Option      | Description                                                                                                      |
| ----------- | ---------------------------------------------------------------------------------------------------------------- |
| **Append**  | Append the results returned by a run of the search to the contents of the CSV file. This is the default setting. |
| **Replace** | Replace the contents of the CSV file with the results returned by a run of the search.                           | 

5. Click **Save**.
## Log events

Construct custom log events to index and search metadata. Log events are sent to your Splunk deployment for indexing. As with other alert actions, log events can be used alone or in addition to other alert actions for a given alert.
### Authorization

Using the log event alert action requires the `edit_log_alert_event` capability.
### Tokens for log events

When you set up a log event alert action, populate event fields with a plain text or tokens representing search, job, or server metadata. You can also use tokens to access the first search results set.
### Set up a log event alert action

Here are the steps for setting up a custom log event alert action after building a search.
#### Prerequisites

Review token usage.
#### Steps

1. You can configure the log event action when creating a new alert or editing an existing alert's actions. Follow one of the options below.

| Option                 | Steps                                                                                                                                             |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| Create a new alert     | From the **Search** page in the **Search and Reporting** app, select **Save as > Alert.** Enter alert details and configure throttling as needed. |
| Edit an existing alert | From the **Alerts** page in the **Search and Reporting** app, select **Edit > Edit actions** for an existing alert.                               | 

2. From the **Add Actions** menu, select **Log Event**.
3. Add the following event information to configure the alert action. Use plain text or tokens for search, job, or server metadata.
	* **Event text**.
	* **Source and sourcetype**.
	* **Host**.
	* **Destination index for the log event**. The `main` index is the default destination. You can specify a different existing index.
In a distributed environment, make sure `outputs.conf` file is configured correctly.
You must also define the destination index on both the search head and the indexers.
4. Click **Save**.
## Monitor triggered alerts

Add an alert to a list of triggered alerts. Review triggered alerts by app context, owner, and severity level.

### Add an alert to the Triggered Alerts list

1. Use on of the following options depending on whether you are creating a new alert or editing an existing alert.

| Option                 | Steps                                                                                                                                             |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| Create a new alert     | From the **Search** page in the **Search and Reporting** app, select **Save as > Alert.** Enter alert details and configure throttling as needed. |
| Edit an existing alert | From the **Alerts** page in the **Search and Reporting** app, select **Edit > Edit actions** for an existing alert.                               | 

2. From the **Add Actions** menu, select **Add to trigger alerts**.
3. Select an alert **Severity** level.
	Severity levels are informational only. They are used to group alerts in the **Triggered Alerts** list. The default level is medium.
4. Click **Save**.

### Reviewing recently triggered alerts

You can see records of recently triggered alerts from the Triggered Alerts page or from an Alert Details page. The Triggered Alerts page shows all instances of triggered alerts. 

Record of triggered alerts details are available for 24h by default.